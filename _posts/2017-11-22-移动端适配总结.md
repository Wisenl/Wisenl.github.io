---
layout:     post
title:      "移动端适配总结"
subtitle:   “谈谈几种常见的移动端适配方案”
date:       2017-11-22
author:     “Wisenl”
header-img: "img/2017-11-20.png"
tags:
    - 技术
    - 布局
---



## 1. 简易方案

直接对html使用：font-size: 625%  。这样的话就能使用rem单位进行开发，1rem=100px。为什么不用1rem=1px 或 1rem = 10px呢？因为Chrome浏览器上有最小字体12px的限制，放以前还能使用 `-webkit-text-size-adjust: none` 来取消限制，现在已经被废弃了。如果遇到浏览器默认html 的font-size 大小不是 16px，则需要使用媒体查询来列出各个需适配的屏幕，手动设置html的font-size 为px单位

```css
@media only screen and (max-width: 750px), only screen and (max-device-width:750px) {
   html {
   	font-size:200px;
   }
}
@media only screen and (max-width: 640px), only screen and (max-device-width:640px) {
   html {
   	font-size:170.6px;
   }
}
@media only screen and (max-width: 414px), only screen and (max-device-width:414px) {
   html {
   	font-size:110.4px;
   }
}
@media only screen and (max-width: 375px), only screen and (max-device-width:375px) {
   html {
   	font-size:100px;
   }
}
@media only screen and (max-width: 320px), only screen and (max-device-width:320px) {
   html {
   	font-size:85.3px;
   }
}
```
换算的方式是：375屏宽的iphone6 下html 字体设置为100px（也就是1rem = 10px），那么整屏宽度为37.5rem。而对于414屏宽应该使用的字体，换算一下就是 414 / 3.75 = 110.4px。其它屏宽设置换算方式同理，用屏宽除以3.75。另外，如果使用的设计稿是以 750px 为屏宽标准的话，需要将设置的html字体缩小50%，即 375 / （3.75  * 2） = 50px ，即1rem = 50px。这样，如果是标注字体为32px（实际为16px），则css为0.32rem（换算后也为16px）。

这样的话，就可以直接使用设计稿上的标注尺寸除以100。比如 标注 元素宽度为80px，则css 设置 width: 0.8rem。

不过这种方案的问题在于，对于不同分辨率的屏幕其适配契合度是分段的而不是平滑的，那么势必会造成某些情况下视觉元素过窄或者过宽。改进的方式就是尽量多设置媒体查询分段，比如每10px设置一个分段，而且要在横向布局时尽量用 flex ，少用固定值。

## 2. 更进一步

使用媒体查询的目的简单又明确，那就是根据不同屏幕宽度设定不同的 html  上 font-size。既然如此，我们为什么不用 JS 来达到目的呢！上代码：

```html
    <script type="text/javascript">
      function refreshRem() {
          var currentWidth = document.documentElement.clientWidth;
          document.documentElement.style.fontSize = currentWidth/3.75 + 'px';
      }
      refreshRem();
      window.addEventListener("resize", refreshRem);
    </script>
```

无缝适配各种宽度，多么清晰明了！可是，用这种方式需要解决一个问题：如何写出Retina屏幕中的物理1px像素？要知道当我们在样式表中写下1px 或者0.01rem 这样的尺寸时，在屏幕上显示的其实是 1* dpr 个物理像素单位（dpr 指 devicePixelRatio）。那写成 1/dpr 呢？也不行！有些安卓的设备在遇到小于1px的时候会自动转换为0px。

所以这个时候就可以用到 [Airen](https://www.w3cplus.com/blogs/airen) 在2015年推出的 [flexible](https://github.com/amfe/lib-flexible/tree/master) 方案。

## 3. lib-flexible

flexible 方案的核心思想有两点

* 使用 `viewport` 来改变页面宽度。

  通常我们是这么设置viewport 的：

  ```html
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  ```

  这会让屏幕显示时的页面宽度等于屏幕逻辑像素宽度，即device-width。而flexible 就是通过动态改写 viewport 的 `scale` 来适配不同屏幕的宽度:

  ```javascript
  var scale = 1 / devicePixelRatio;

  document.querySelector('meta[name="viewport"]').setAttribute('content','initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');
  ```

* 动态设置html 的font-size 值。

  ```javascript
  document.documentElement.style.fontSize = document.documentElement.clientWidth / 10 + 'px';
  ```

  这样的话，1rem = 十分之一屏宽。那么样式表中的css = 设计稿标注尺寸 / 设计稿横向尺寸 * 10 （rem）。flexible 使得屏幕的css像素和物理像素一致，那就可以实现 1px 的物理像素显示，解决了上面说的问题。

  ​

可是，经过这么一折腾，又有新的问题：设计原则上使用文本字体时是不希望字体大小随着屏幕大小而变化的，所以不适合使用rem为单位。但是如果使用px单位的话，在不同retina值得屏幕下显示的字体大小是和retina 值成反比的。flexib 的解决方法是，把retina值动态设置到html元素上 ：

```javascript
var dpr = devicePixelRetio;
docEl.setAttribute('data-dpr', dpr);
```

在设置字体大小的时候，就根据html上 'data-dpr' 属性值来区分

```css
div {
  width: 1rem; height: 0.4rem; font-size: 12px; // 默认写上dpr为1的fontSize 
} 
[data-dpr="2"] div {
  font-size: 24px; 
} 
[data-dpr="3"] div {
  font-size: 36px; 
}
```

当然，使用Scss会更加方便,

```scss
/*定义混合宏：*/
@mixin font-dpr($font-size){
  font-size: $font-size; 
  [data-dpr="2"] & {
    font-size: $font-size * 2; 
  } 
  [data-dpr="3"] & {
    font-size: $font-size * 3; 
  }
}
/* 使用*/
@include font-dpr(12px);
```

## 4. 改造版

[wis-flexible](https://github.com/Wisenl/wis-flexible) 

改成我自己喜欢的方案~

`viewport`

```javascript
metaEl.setAttribute('content', 'width=' + width + ', initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');
```

`font-size`

```javascript
docEl.style.fontSize = parseFloat(width / 3.75).toFixed(2) + 'px';
```

使用时 px 转 rem 只需除以100 就行

## 5. 新版本flexible

今年 Airen 又推出了新的flexible方案，以此代替之前的版本。实现的方式是使用css3 新特性 vw 和vh 单位。GitHub地址：[lib-flexible](https://github.com/amfe/lib-flexible) 

>`vw`：是Viewport's width的简写,`1vw`等于`window.innerWidth`的`1%`
>
>`vh`：和`vw`类似，是Viewport's height的简写，`1vh`等于`window.innerHeihgt`的`1%`
>
>`vmin`：`vmin`的值是当前`vw`和`vh`中较小的值
>
>`vmax`：`vmax`的值是当前`vw`和`vh`中较大的值

猛戳 [这里](https://www.w3cplus.com/css/vw-for-layout.html)，查看详情。



PS: 我个人还是更喜欢之前的版本。



> **小概念：**
>
> 
>
> Viewport  移动网页可视区域，这个区域一般大于或等于屏幕宽度。可以通过平移和缩放来查看网页各个部分
>
> PPK 对viewport 的理论：
>
> **Layout viewport** :  document.documentElement.clientWidth  或者 document.documentElement.getBoundingClientRect().width
>
> **Visual viewport**: window.innerWidth     或者 window.screen.width
>
> **Idea viewport**: iphone6中为375
>
> ------
>
> 媒体查询 @media
>
> 语法
>
> ```css
> @media mediatype and|not|only (media feature) {
>     CSS-Code;
> }
> ```
>
> 或者使用 stylesheets
>
> ```html
> <link rel="stylesheet" media="mediatype and|not|only (media feature)" href="mystylesheet.css">
> ```



参考文章：

* 诸葛流云：[从网易与淘宝的font-size思考前端设计稿与工作流](http://www.cnblogs.com/lyzg/p/4877277.html)
* 大漠：[使用Flexible实现手淘H5页面的终端适配](https://www.w3cplus.com/mobile/lib-flexible-for-html5-layout.html)

