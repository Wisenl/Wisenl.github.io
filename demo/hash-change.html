<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1, minimum-scale=1 maximum-scale=1, user-scalable=no,minimal-ui">
    <title>knowledge-base</title>
    <style media="screen">

      body {
        margin: 0;
        font-size: 0.16rem
      }
      .box {
        width: 3.75rem;
        height: 3.75rem;
        background: orange;
      }
      .half {
        width: 0.375rem;
        height: 0.375rem;
        background: green;
        display: inline-block;
        word-spacing: 0;
        border: 1px solid blue;
      }
    </style>
    <script type="text/javascript">
      function refreshRem() {
          var currentWidth = document.documentElement.clientWidth;
          document.documentElement.style.fontSize = currentWidth/3.75 + 'px';
      }
      refreshRem();
      window.addEventListener("resize", refreshRem);
    </script>
  </head>
  <body>
    <div id="app">
        <button id="button">点击扫描</button>
        <div class="box">
          我
        </div>
        <div>
          <div class="half">
            你
          </div>
          <div class="half">
            你
          </div>
          <div class="half">
            你
          </div>
          <div class="half">
            你
          </div>
          <div class="half">
            你
          </div>
      </div>
    </div>
    <!-- built files will be auto injected -->
  </body>
  <script>
      window.onload = function () {
        var historyModule = {
          listener: [],
          listen: function (listener) {
              this.listener.push(listener);
              console.log('historyModule listen..')
          },
          updateLocation: function(){
              this.listener.forEach(function(listener){
                  listener('new localtion');
              })
          }
        }

        // Router 将使用 historyModule 对象，并对其包装
        var Router = {
          source: {},
          init: function(source){
              this.source = source;
          },
          // 对 historyModule的listen进行了一层包装
          listen: function(listener) {
              return this.source.listen(function(location){
                  console.log('Router listen tirgger.');
                  listener(location);
              })
          }
        }

        // 将 historyModule 注入进 Router 中
        Router.init(historyModule);
        // Router 注册监听
        Router.listen(function(location){
          console.log(location + '-> Router setState.');
        })
        // historyModule 触发回调
        historyModule.updateLocation();
      }
  </script>
</html>
